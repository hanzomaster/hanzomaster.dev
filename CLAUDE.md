# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Overview

This is a minimal, pixel-perfect design engineer portfolio, component registry, and blog built with Next.js 16, Tailwind CSS v4, and React 19. The site features dynamic portfolio content, a curated registry system for distributing components, and a blog with MDX support.

## Quick Commands

### Development
- `pnpm dev` - Start development server on port 1408
- `pnpm build` - Build for production
- `pnpm start` - Run production server
- `pnpm preview` - Build and start production locally

### Code Quality
- `pnpm lint` - Run ESLint checks
- `pnpm lint:fix` - Fix ESLint issues
- `pnpm check-types` - Type check without emitting
- `pnpm format:check` - Check Prettier formatting
- `pnpm format:write` - Fix formatting with Prettier

### Registry
- `pnpm registry:build` - Build and generate registry JSON files
- `pnpm registry:internal:build` - Build registry without shadcn step

### Other
- `pnpm capture` - Run screenshot capture script
- `pnpm upgrade:next` - Upgrade to latest Next.js
- `pnpm upgrade:tailwind` - Upgrade to latest Tailwind CSS

## Architecture

### Directory Structure

```
src/
├── app/              # Next.js app router (pages and routes)
│   ├── (app)/        # Main app layout group
│   ├── (docs)/       # Blog and components docs
│   ├── (llms)/       # LLM-ready endpoints (.txt, .md files)
│   └── og/           # Dynamic OG image generation
├── features/         # Feature-scoped code
│   ├── blog/         # Blog system (posts, search, RSS)
│   ├── portfolio/    # Portfolio content and components
│   └── sponsors/     # Sponsor/credit information
├── components/       # Shared UI components
│   └── ui/           # Base UI primitives (shadcn/ui, custom)
├── registry/         # Component registry for distribution
├── hooks/            # Custom React hooks
├── lib/              # Utilities and helpers
├── utils/            # Pure utility functions
├── types/            # Shared TypeScript types
└── assets/           # Static assets
```

### Feature Structure

Each feature (blog, portfolio) follows this pattern:
```
src/features/<feature>/
├── components/       # React components
├── data/            # Static data files (posts, projects, etc.)
├── hooks/           # Feature-specific hooks
├── lib/             # Feature utilities
├── types/           # Feature-specific types
└── content/         # MDX content files (blog posts, etc.)
```

### Key Architectural Patterns

**Panel Layout System**: The portfolio uses a custom `Panel` component (`src/features/portfolio/components/panel.tsx`) that wraps sections with consistent borders and styling. Used as the base layout for all portfolio sections.

**Data-Driven Portfolio**: Portfolio content (experiences, projects, certifications, bookmarks, awards) is stored in static data files under `src/features/portfolio/data/`. Each data file exports a constant array that drives the UI component.

**Feature Components**: Main feature components import and compose sub-components and data:
- `Experiences` → imports `experience-item.tsx` + `experiences.ts` data
- `Projects` → imports `project-item.tsx` + `projects.ts` data
- `Bookmarks` → imports `bookmark-item.tsx` + `bookmarks.ts` data

**Path Alias**: Use `@/` for imports instead of relative paths (configured in `tsconfig.json`).

**MDX + Markdown**: Blog content uses `next-mdx-remote` for rendering MDX files from `src/features/blog/content/`. Posts are indexed dynamically via `src/features/blog/data/posts.ts`.

### Blog System

- **Content location**: `src/features/blog/content/*.mdx`
- **Post indexing**: `src/features/blog/data/posts.ts` manually indexes posts
- **RSS feed**: Generated at `/blog/rss` via dynamic route
- **Search**: Client-side search in `src/features/blog/hooks/use-search-query.ts`
- **Syntax highlighting**: Using Shiki for code blocks

### Registry System

The registry uses shadcn CLI for distributing custom components. Configuration:
- **Registry source**: `src/__registry__/`
- **Build output**: `src/__registry__/registry.autogenerated.json`
- **Build command**: `pnpm registry:build`

Registry entries are defined in `src/registry/index.ts` and include component examples.

## Important Implementation Details

### Tailwind CSS v4
- Uses Tailwind CSS v4 with new CSS variable-based architecture
- Custom CSS patterns used (e.g., repeating gradients in Separator)
- Configure through `postcss.config.js` (not a TS file in this project)

### Next.js 16 Configuration
- **Output mode**: `standalone` for Docker deployment
- **Rewrites**: Blog posts accessible at `/blog/:slug.mdx` and `/components/:slug.mdx`
- **Image optimization**: Remote patterns configured for `assets.chanhdai.com` and `unsplash.com`
- **Dev port**: Custom dev server on port 1408 (set in `next.config.ts`)
- **Turbopack**: Enabled for bundler performance

### Environment Variables
- Configuration required: Copy `.env.example` to `.env.local`
- Variables likely include: PostHog API key, c15t consent manager config, asset URLs
- Check `.env.example` for required variables before development

### Type Safety
- **Strict mode**: TypeScript configured with `strict: true`
- **No emit**: Type checking only (`noEmit: true`)
- **React 19 & 19.2.7**: Both React and React DOM pinned to specific versions
- **Total TypeScript reset**: Using `@total-typescript/ts-reset` for stricter typing

### Analytics & Consent
- **PostHog integration**: Client-side tracking with consent management
- **c15t library**: Consent manager for cookieless tracking until user consent
- **Production-only**: Analytics only active in production builds
- **Event schema**: Type-safe events defined with Zod validation

## Adding Content to the Portfolio

### Adding Portfolio Sections
1. Create data file: `src/features/portfolio/data/<section>.ts`
2. Create types file: `src/features/portfolio/types/<section>.ts`
3. Create component: `src/features/portfolio/components/<section>/`
4. Import in homepage: `src/app/(app)/(root)/page.tsx`

### Adding Bookmarks
See `docs/BOOKMARKS.md` for detailed instructions. Quick summary:
- Edit: `src/features/portfolio/data/bookmarks.ts`
- Type defined in: `src/features/portfolio/types/bookmarks.ts`
- Component: `src/features/portfolio/components/bookmarks/`

### Adding Blog Posts
1. Create MDX file: `src/features/blog/content/<slug>.mdx`
2. Add entry to `src/features/blog/data/posts.ts`:
   ```typescript
   {
     title: "Post Title",
     slug: "post-slug",
     date: "2025-12-22",
     description: "Brief description",
   }
   ```
3. Post becomes accessible at `/blog/post-slug`

### Adding Registry Components
1. Create component: `src/registry/<component-name>/`
2. Define in registry: `src/registry/index.ts`
3. Rebuild: `pnpm registry:build`
4. Component then available via `npx shadcn add <registry-url>`

## Common Patterns

### Styling Components
- Use `cn()` utility from `src/lib/utils.ts` to merge Tailwind classes
- Pattern: `className={cn("base-styles", className, condition && "conditional-styles")}`
- Avoid inline styles; use Tailwind utilities instead

### Data Component Integration
- Import data type from `src/features/<feature>/types/`
- Import data array from `src/features/<feature>/data/`
- Map over data array in component render
- Create sub-component for individual items (e.g., `BookmarkItem`, `ProjectItem`)

### Form Handling
- Using `react-hook-form` for forms
- UI components available in `src/components/ui/form.tsx`
- Validation with `@hookform/resolvers` and Zod schemas

### Navigation & Command Menu
- Command menu at `src/components/command-menu.tsx`
- Links to major sections defined there
- Keyboard shortcut: `Cmd+K` or `Ctrl+K`

## Code Style Notes

- Use functional components with hooks
- Keep components small and focused
- Extract repeated logic into hooks or utilities
- Use TypeScript strictly (no `any` types)
- Import order: external packages, then relative imports (ESLint enforces via `simple-import-sort`)
- Component files should be focused (one component per file or well-organized composite components)

## Git Workflow

- Main branch: `main`
- Make feature branches for significant changes
- Commit messages follow convention: `<type>(<scope>): <subject>`
- Types: `feat`, `fix`, `docs`, `style`, `refactor`, `test`, `chore`, `perf`

## Deployment

- **Build output**: `standalone` mode for efficient Docker builds
- **Start script**: `pnpm start` (NODE_ENV=production)
- **Port**: Application serves on port 3000 by default (dev uses 1408)
- **Assets**: Remote images served from `assets.chanhdai.com`
